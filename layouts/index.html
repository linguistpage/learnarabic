{{ define "main" }}

<title>{{ .Site.Title }}</title>


<div class="control">
  <!-- Search input -->
  <label for="searchInput">Search:</label>
  <input type="text" id="searchInput" placeholder="Search items...">

  <!-- Radio buttons for filtering by language -->
  <div style="margin-top: 5px;">
  <label>Filter by Language:</label>
  <div id="languageFilter">
    <label><input type="radio" name="language" value="all" checked> All</label>
  </div>
</div>
</div>

<!-- List of content grouped by categories -->
<div id="content-list">
  {{ $categories := .Site.RegularPages.GroupByParam "categories" }}
  {{ range $categories }}
  <div class="category-group" data-category="{{ .Key }}">
    <h2>{{ .Key }}</h2>
    <ul>
      {{ range .Pages }}
      <li data-title="{{ .Title }}" data-language="{{ .Params.languages }}">
        {{ if .Params.link }}
        <a href="{{ .Params.link }}">{{ .Title }}</a>

        <small style="line-height: 1; display:block; font-size: 10px; color: #999;">{{ .Params.Dialects}} - {{if .Params.instructors }}{{ .Params.instructors }}-{{end}}  {{ .Params.subjects}}</small>

        {{ else }}
        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
        {{ end }}
      </li>
      {{ end }}
    </ul>
  </div>
  {{ end }}
</div>

<div id="content-list">
  <div class="category-group">
    <h2>All Instructors</h2>
<ul>
    {{ range .Site.Taxonomies.instructors }}
            <li data-title="{{ .Page.Title }}"><a href="{{ .Page.Permalink }}">{{ .Page.Title }}</a> {{ .Count }}</li>
    {{ end }}
</ul>
</div>

<div class="category-group">
  <h2>All Dialects</h2>
<ul>
  {{ range .Site.Taxonomies.dialects }}
          <li data-title="{{ .Page.Title }}"><a href="{{ .Page.Permalink }}">{{ .Page.Title }}</a> {{ .Count }}</li>
  {{ end }}
</ul>
</div>

<div class="category-group">
  <h2>All Subjects</h2>
<ul>
  {{ range .Site.Taxonomies.subjects }}
          <li data-title="{{ .Page.Title }}"><a href="{{ .Page.Permalink }}">{{ .Page.Title }}</a> {{ .Count }}</li>
  {{ end }}
</ul>
</div>

</div>
<script>
  // Populate unique languages as radio buttons
  const languageFilter = document.getElementById('languageFilter');
  const languages = new Set();
  document.querySelectorAll('[data-language]').forEach(item => {
    languages.add(item.getAttribute('data-language'));
  });
  languages.forEach(language => {
    const label = document.createElement('label');
    const radio = document.createElement('input');
    radio.type = 'radio';
    radio.name = 'language';
    radio.value = language;
    label.appendChild(radio);
    label.appendChild(document.createTextNode(language));
    languageFilter.appendChild(label);
  });

  // Filter items
  function filterItems() {
    const searchValue = document.getElementById('searchInput').value.toLowerCase();
    const checkedRadio = document.querySelector('#languageFilter input:checked');
    const languageFilterValue = checkedRadio ? checkedRadio.value : 'all';
    const items = document.querySelectorAll('#content-list li');

    items.forEach(item => {
      const title = item.getAttribute('data-title').toLowerCase();
      const language = item.getAttribute('data-language');

      const matchesSearch = title.includes(searchValue);
      const matchesLanguage = (languageFilterValue === 'all') || (language === languageFilterValue);

      if (matchesSearch && matchesLanguage) {
        item.style.display = 'list-item';
      } else {
        item.style.display = 'none';
      }
    });

    // Show/hide category groups based on filtered items
    const categoryGroups = document.querySelectorAll('.category-group');
    categoryGroups.forEach(group => {
      const visibleItems = group.querySelectorAll('li[style="display: list-item;"]');
      if (visibleItems.length > 0) {
        group.style.display = 'block';
      } else {
        group.style.display = 'none';
      }
    });
  }

  // Attach event listeners
  document.getElementById('searchInput').addEventListener('input', filterItems);
  document.getElementById('languageFilter').addEventListener('change', filterItems);

  // Initial call to filter items
  filterItems();
</script>

{{ end }}
