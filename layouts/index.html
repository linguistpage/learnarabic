{{ define "main" }}

<title>{{ .Site.Title }}</title>


<div class="control">
  <!-- Radio buttons for filtering by language -->
  <div>
    <label>1. Choose your language:</label>
    <small  id="languageFilter">
      <label><input type="radio" name="language" value="all" checked> All</label>
    </small>
  </div>
  <!-- Search input -->
  <label for="searchInput">2. Search the results:</label>
  <input type="text" id="searchInput" placeholder="Search Resources...">
</div>

<!-- List of content grouped by subjects -->
<div id="content-list">
  {{ $subjects := .Site.RegularPages.GroupByParam "subjects" }}
<ul>
  {{ range $subjects }}
  <div class="category-group" data-category="{{ .Key }}">
    <h4>{{ .Key }}</h4>
    
      {{ range .Pages }}
      <li data-title="{{ .Title }}" data-language="{{ .Params.languages }}">
        {{ if .Params.link }}
        <a href="{{ .Params.link }}">{{ .Title }}</a>
        <small>{{ .Params.Dialects}} - {{if .Params.instructors }}{{ .Params.instructors }}-{{end}}  {{ .Params.categories}}</small>
        {{ else }}
        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
        {{ end }}
      </li>
      {{ end }}
    </ul>
  </div>
  {{ end }}
</div>

<div>
  <div>
    <br>
    <h3>Search Instructors / Dialects / Subjects</h3>
    <input type="text" id="globalSearch" onkeyup="filterAllLists()" placeholder="Search instructors, dialects, subjects...">
  </div>
  <div>
    <h4>All Instructors</h4>
    <ul id="instructorsList">
      {{ range .Site.Taxonomies.instructors }}
      <li><a href="{{ .Page.Permalink }}">{{ .Page.Title }}&nbsp;</a><small>({{ .Count }})</small></li>
      {{ end }}
    </ul>
  </div>
  <div>
    <h4>All Dialects</h4>
    <ul id="dialectsList">
      {{ range .Site.Taxonomies.dialects }}
      <li><a href="{{ .Page.Permalink }}">{{ .Page.Title }}&nbsp;</a><small>({{ .Count }})</small></li>
      {{ end }}
    </ul>
  </div>
  <div>
    <h4>All Subjects</h4>
    <ul id="subjectsList">
      {{ range .Site.Taxonomies.subjects }}
      <li><a href="{{ .Page.Permalink }}">{{ .Page.Title }}&nbsp;</a><small>({{ .Count }})</small></li>
      {{ end }}
    </ul>
  </div>
</div>

<script>
  function filterAllLists() {
    // Get the search input element and its value
    var input = document.getElementById('globalSearch');
    var filter = input.value.toLowerCase();

    // Get all lists to be filtered
    var lists = ['instructorsList', 'dialectsList', 'subjectsList'];

    // Loop through each list
    lists.forEach(function(listId) {
      var list = document.getElementById(listId);
      var items = list.getElementsByTagName('li');

      // Loop through the list items and hide those that don't match the search query
      for (var i = 0; i < items.length; i++) {
        var item = items[i];
        var textValue = item.textContent || item.innerText;
        if (textValue.toLowerCase().indexOf(filter) > -1) {
          item.style.display = "";
        } else {
          item.style.display = "none";
        }
      }
    });
  }

  // Populate unique languages as radio buttons
  const languageFilter = document.getElementById('languageFilter');
  const languages = new Set();
  document.querySelectorAll('[data-language]').forEach(item => {
    languages.add(item.getAttribute('data-language'));
  });
  languages.forEach(language => {
    const label = document.createElement('label');
    const radio = document.createElement('input');
    radio.type = 'radio';
    radio.name = 'language';
    radio.value = language;
    label.appendChild(radio);
    label.appendChild(document.createTextNode(language));
    languageFilter.appendChild(label);
  });

  // Filter items
  function filterItems() {
    const searchValue = document.getElementById('searchInput').value.toLowerCase();
    const checkedRadio = document.querySelector('#languageFilter input:checked');
    const languageFilterValue = checkedRadio ? checkedRadio.value : 'all';
    const items = document.querySelectorAll('#content-list li');

    items.forEach(item => {
      const title = item.getAttribute('data-title').toLowerCase();
      const language = item.getAttribute('data-language');

      const matchesSearch = title.includes(searchValue);
      const matchesLanguage = (languageFilterValue === 'all') || (language === languageFilterValue);

      if (matchesSearch && matchesLanguage) {
        item.style.display = 'list-item';
      } else {
        item.style.display = 'none';
      }
    });

    // Show/hide category groups based on filtered items
    const categoryGroups = document.querySelectorAll('.category-group');
    categoryGroups.forEach(group => {
      const visibleItems = group.querySelectorAll('li[style="display: list-item;"]');
      if (visibleItems.length > 0) {
        group.style.display = 'block';
      } else {
        group.style.display = 'none';
      }
    });
  }

  // Attach event listeners
  document.getElementById('searchInput').addEventListener('input', filterItems);
  document.getElementById('languageFilter').addEventListener('change', filterItems);

  // Initial call to filter items
  filterItems();
</script>

{{ end }}
