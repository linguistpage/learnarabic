{{ define "main" }}

<title>{{ .Site.Title }}</title>


<div class="control">
  <!-- Search input -->
  <label for="searchInput">Search:</label>
  <input type="text" id="searchInput" placeholder="Search Resources...">

  <!-- Radio buttons for filtering by language -->
  <div style="margin-top: 5px;">
  <label><h3>Choose your language:<h3></label>
  <div id="languageFilter">
    <label><input type="radio" name="language" value="all" checked> All</label>
  </div>
</div>
</div>

<!-- List of content grouped by categories -->
<div id="content-list">
  {{ $categories := .Site.RegularPages.GroupByParam "categories" }}
  {{ range $categories }}
  <div class="category-group" data-category="{{ .Key }}">
    <h2>{{ .Key }}</h2>
    <ul>
      {{ range .Pages }}
      <li data-title="{{ .Title }}" data-language="{{ .Params.languages }}">
        {{ if .Params.link }}
        <a href="{{ .Params.link }}">{{ .Title }}</a>

        <small style="line-height: 1; display:block; color: #999;">{{ .Params.Dialects}} - {{if .Params.instructors }}{{ .Params.instructors }}-{{end}}  {{ .Params.subjects}}</small>

        {{ else }}
        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
        {{ end }}
      </li>
      {{ end }}
    </ul>
  </div>
  {{ end }}
</div>

<div>
  <div>
    <h2>Search Instructors / Dialects / Subjects </h2>
    <input style="margin-top: 10px; margin-bottom: 5px; " type="text" id="globalSearch" onkeyup="filterAllLists()" placeholder="Search instructors, dialects, subjects...">
  </div>
  <div>
    <h3 style="background: #eee; padding:5px;">All Instructors</h3>
    <ul id="instructorsList">
      {{ range .Site.Taxonomies.instructors }}
              <li style="display: inline-block !important;"><a href="{{ .Page.Permalink }}">{{ .Page.Title }}&nbsp;</a><small>({{ .Count }})</small>  &nbsp; </li>
      {{ end }}
    </ul>
  </div>
  <div>
    <h3 style="background: #eee; padding:5px;">All Dialects</h3>
    <ul id="dialectsList">
      {{ range .Site.Taxonomies.dialects }}
              <li style="display: inline-block !important;"><a href="{{ .Page.Permalink }}">{{ .Page.Title }}&nbsp;</a><small>({{ .Count }})</small>  &nbsp; </li>
      {{ end }}
    </ul>
  </div>
  <div>
    <h3 style="background: #eee; padding:5px;">All Subjects</h3>
    <ul id="subjectsList">
      {{ range .Site.Taxonomies.subjects }}
              <li style="display: inline-block !important;"><a href="{{ .Page.Permalink }}">{{ .Page.Title }}&nbsp;</a><small>({{ .Count }})</small>  &nbsp; </li>
      {{ end }}
    </ul>
  </div>


<script>
function filterAllLists() {
  // Get the search input element and its value
  var input = document.getElementById('globalSearch');
  var filter = input.value.toLowerCase();

  // Get all lists to be filtered
  var lists = ['instructorsList', 'dialectsList', 'subjectsList'];

  // Loop through each list
  lists.forEach(function(listId) {
    var list = document.getElementById(listId);
    var items = list.getElementsByTagName('li');

    // Loop through the list items and hide those that don't match the search query
    for (var i = 0; i < items.length; i++) {
      var item = items[i];
      var textValue = item.textContent || item.innerText;
      if (textValue.toLowerCase().indexOf(filter) > -1) {
        item.style.display = "";
      } else {
        item.style.display = "none";
      }
    }
  });
}
</script>

<script>
  // Populate unique languages as radio buttons
  const languageFilter = document.getElementById('languageFilter');
  const languages = new Set();
  document.querySelectorAll('[data-language]').forEach(item => {
    languages.add(item.getAttribute('data-language'));
  });
  languages.forEach(language => {
    const label = document.createElement('label');
    const radio = document.createElement('input');
    radio.type = 'radio';
    radio.name = 'language';
    radio.value = language;
    label.appendChild(radio);
    label.appendChild(document.createTextNode(language));
    languageFilter.appendChild(label);
  });

  // Filter items
  function filterItems() {
    const searchValue = document.getElementById('searchInput').value.toLowerCase();
    const checkedRadio = document.querySelector('#languageFilter input:checked');
    const languageFilterValue = checkedRadio ? checkedRadio.value : 'all';
    const items = document.querySelectorAll('#content-list li');

    items.forEach(item => {
      const title = item.getAttribute('data-title').toLowerCase();
      const language = item.getAttribute('data-language');

      const matchesSearch = title.includes(searchValue);
      const matchesLanguage = (languageFilterValue === 'all') || (language === languageFilterValue);

      if (matchesSearch && matchesLanguage) {
        item.style.display = 'list-item';
      } else {
        item.style.display = 'none';
      }
    });

    // Show/hide category groups based on filtered items
    const categoryGroups = document.querySelectorAll('.category-group');
    categoryGroups.forEach(group => {
      const visibleItems = group.querySelectorAll('li[style="display: list-item;"]');
      if (visibleItems.length > 0) {
        group.style.display = 'block';
      } else {
        group.style.display = 'none';
      }
    });
  }

  // Attach event listeners
  document.getElementById('searchInput').addEventListener('input', filterItems);
  document.getElementById('languageFilter').addEventListener('change', filterItems);

  // Initial call to filter items
  filterItems();
</script>

{{ end }}
